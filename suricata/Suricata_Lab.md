# Examine alerts, logs, and rules with Suricata

## Experiment

### Lab Overview
- **Duration:** 1 hour
- **Cost:** No cost
- **Level:** Introductory

### Activity Overview
Previously, you learned about packet analysis and the basic syntax and components of intrusion detection systems (IDS) signatures and rules. You also learned how to examine a prewritten signature and its log output in Suricata, an open-source intrusion detection system, intrusion prevention system, and network analysis tool.

In this lab activity, you’ll explore more about Suricata alerts and logs, including the general process of rule creation.

The Suricata tool monitors network interfaces and applies rules to the packets that pass through the interface. Suricata determines whether each packet should generate an alert and be dropped, rejected, or allowed to pass through the interface.

Source and destination networks must be specified in the Suricata configuration. Custom rules can be written to specify which traffic should be processed.

You’ll examine a rule and practice using Suricata to trigger alerts on network traffic. You’ll also analyze log outputs, such as a `fast.log` and `eve.json` file. This will help you understand some of the alerts and logs generated by Suricata.

Let’s get started with Suricata!

> **Note:** The terms rules and signatures are used interchangeably in this lab activity.

### Scenario
In this scenario, you’re a security analyst who must monitor traffic on your employer's network. You’ll be required to configure Suricata and use it to trigger alerts.

Here’s how you'll do this task: First, you'll explore custom rules in Suricata. Second, you'll run Suricata with a custom rule in order to trigger it, and examine the output logs in the `fast.log` file. Finally, you’ll examine the additional output that Suricata generates in the standard `eve.json` log file.

For the purposes of the tests you’ll run in this lab activity, you’ve been supplied with a `sample.pcap` file and a `custom.rules` file. These reside in your home folder.

### Files Description
- **sample.pcap:** Packet capture file containing an example of network traffic data.
- **custom.rules:** Contains a custom rule to analyze.
- **fast.log:** Contains the alerts that Suricata generates.
- **eve.json:** Standard log file with detailed JSON output.

---

## Tasks

### Task 1: Examine a Custom Rule in Suricata
1. Use the `cat` command to display the rule in the `custom.rules` file:
   ```bash
   cat custom.rules
   ```

2. Examine the three components of the rule:
   - **Action:** Defines what happens when the rule is triggered (e.g., alert, drop, pass, reject).
   - **Header:** Specifies the protocol, source/destination IPs, ports, and traffic direction.
   - **Rule Options:** Customize the rule with parameters like `msg`, `flow`, `content`, `sid`, and `rev`.

#### Example Rule
```bash
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"GET on wire"; flow:established,to_server; content:"GET"; http_method; sid:12345; rev:3;)
```

### Task 2: Trigger a Custom Rule in Suricata
1. List files in the `/var/log/suricata` directory:
   ```bash
   ls -l /var/log/suricata
   ```
2. Run Suricata:
   ```bash
   sudo suricata -r sample.pcap -S custom.rules -k none
   ```
   - **Options Explained:**
     - `-r`: Specifies the input file.
     - `-S`: Specifies the rules file.
     - `-k none`: Disables checksum checks.
3. Examine the `fast.log` file:
   ```bash
   cat /var/log/suricata/fast.log
   ```

### Task 3: Examine eve.json Output
1. Display entries in `eve.json`:
   ```bash
   cat /var/log/suricata/eve.json
   ```
2. Use `jq` for better readability:
   ```bash
   jq . /var/log/suricata/eve.json | less
   ```
3. Extract specific event data:
   ```bash
   jq -c "[.timestamp,.flow_id,.alert.signature,.proto,.dest_ip]" /var/log/suricata/eve.json
   ```
4. Filter logs by `flow_id`:
   ```bash
   jq "select(.flow_id==X)" /var/log/suricata/eve.json
   ```

---

## Conclusion
Great work! You’ve completed this activity and now understand:
- Creating custom rules and running them in Suricata.
- Monitoring traffic captured in a packet capture file.
- Analyzing `fast.log` and `eve.json` outputs.

### End your Lab
1. Click **End Lab** and confirm.
2. Provide feedback in the pop-up box.
3. Refresh the course tab to mark the lab as complete.

